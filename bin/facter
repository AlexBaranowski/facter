#!/usr/bin/env ruby
# frozen_string_literal: true

require 'open3'
require 'json'
require 'thor'
require 'pry-byebug'

require './lib/cli'
require './lib/base'
require './config/config'
require './config/logger'
require './lib/resolvers/base_resolver'

def load_dirs(*dirs)
  # binding.pry
  Dir.glob(File.join('./lib', dirs, '*.rb'), &method(:require))
end

load_dirs('resolvers')
load_dirs('utils')
load_dirs('models')

os = OsDetector.detect_family

load_dirs('facts', os.to_s, '**')

ARGV.unshift(Facter::Cli.default_task) unless
  Facter::Cli.all_tasks.key?(ARGV[0]) ||
  Facter::Cli.instance_variable_get(:@map).key?(ARGV[0])
Facter::Cli.start(ARGV)
